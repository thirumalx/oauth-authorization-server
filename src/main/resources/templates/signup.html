<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Create your account to access the authorization server">
    <title>Create Account - Authorization Server</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link th:href="@{/style/signup.css}" rel="stylesheet" />
</head>

<body>
    <div class="content">

        <h2 class="title">Create Account</h2>

        <form th:action="@{/signup}" th:object="${userResource}" method="post" id="signupForm">

            <!-- Error Messages -->
            <div th:if="${#fields.hasErrors('*')}" class="error-message"
                style="background: #fee2e2; padding: 12px 16px; border-radius: 12px; margin-bottom: 20px; border-left: 4px solid #dc2626;">
                <ul style="list-style: none; margin: 0; padding: 0;">
                    <li th:each="err : ${#fields.errors('*')}" th:text="${err}"
                        style="color: #dc2626; font-size: 14px; margin: 4px 0;"></li>
                </ul>
            </div>

            <!-- Hidden field to preserve registeredClientId from query parameter -->
            <input type="hidden" th:field="*{registeredClientId}" />

            <!-- Name Row -->
            <div class="form-row">
                <div class="form-field">
                    <label>First Name</label>
                    <input type="text" th:field="*{firstName}" required>
                </div>

                <div class="form-field">
                    <label>Middle Name</label>
                    <input type="text" th:field="*{middleName}">
                </div>

                <div class="form-field">
                    <label>Last Name</label>
                    <input type="text" th:field="*{lastName}" required>
                </div>
            </div>

            <!-- Email + Phone Row -->
            <div class="form-row">
                <div class="form-field">
                    <label>Email</label>
                    <input type="email" th:field="*{email}" required>
                </div>

                <div class="form-field">
                    <label>Phone Number</label>
                    <input type="tel" th:field="*{phoneNumber}" required pattern="^[0-9]{10,15}$"
                        placeholder="10â€“15 digit number">
                </div>
            </div>

            <!-- Password Row -->
            <div class="form-row">
                <div class="form-field">
                    <label>Password</label>
                    <input type="password" th:field="*{password}" required minlength="6">
                </div>

                <div class="form-field">
                    <label>Confirm Password</label>
                    <input type="password" name="confirmPassword" required minlength="6">
                </div>
            </div>

            <!-- Individual / Organisation + DOB -->
            <div class="form-row align-center">
                <div class="toggle-group">
                    <label><input type="radio" th:field="*{individual}" value="true" checked> Individual</label>
                    <label><input type="radio" th:field="*{individual}" value="false"> Organisation</label>
                </div>

                <div class="form-field">
                    <label id="dobLabel"
                        th:text="${userResource.individual} ? 'Date of Birth' : 'Date of Incorporation'">
                    </label>
                    <input type="date" th:field="*{dateOfBirth}" required>
                </div>
            </div>


            <button type="submit" class="primary-btn" id="submitBtn">Create Account</button>

            <p style="text-align: center; margin-top: 20px; color: #6b7280; font-size: 14px;">
                Already have an account?
                <a th:href="@{/login}"
                    style="color: #667eea; text-decoration: none; font-weight: 600; transition: color 0.2s;">Sign in</a>
            </p>

        </form>

    </div>

    <script>
        // Auto-dismiss messages after 5 seconds
        document.addEventListener('DOMContentLoaded', function () {
            const messages = document.querySelectorAll('.success-message, .error-message');
            messages.forEach(message => {
                setTimeout(() => {
                    message.style.transition = 'opacity 0.5s ease-out';
                    message.style.opacity = '0';
                    setTimeout(() => {
                        message.remove();
                    }, 500);
                }, 5000);
            });
        });

        const individual = document.querySelector("input[value='true']");
        const org = document.querySelector("input[value='false']");
        const dobLabel = document.getElementById("dobLabel");

        function updateLabel() {
            dobLabel.textContent = individual.checked
                ? "Date of Birth"
                : "Date of Incorporation";
        }

        individual.addEventListener("change", updateLabel);
        org.addEventListener("change", updateLabel);

        updateLabel();
    </script>

</body>

</html>